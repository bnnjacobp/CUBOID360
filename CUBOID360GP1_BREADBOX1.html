<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Educational Bread Box Applet</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #fcfcfc;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            touch-action: none;
        }

        canvas {
            display: block;
        }

        #main-header {
            position: absolute;
            top: 20px;
            width: 100%;
            text-align: center;
            padding: 0 20px;
            box-sizing: border-box;
            font-size: clamp(18px, 2.5vw, 24px);
            font-weight: bold;
            color: #3e2723;
            z-index: 10;
            pointer-events: none;
        }

        #pointers-container {
            position: absolute;
            top: 100px;
            left: 20px;
            max-width: 480px;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-left: 5px solid #8d6e63;
            border-radius: 4px;
            z-index: 10;
            pointer-events: none;
            box-shadow: 2px 2px 15px rgba(0, 0, 0, 0.08);
        }

        .pointer-item {
            margin-bottom: 12px;
            font-size: clamp(13px, 1.5vw, 15px);
            line-height: 1.4;
            color: #4e342e;
            font-weight: 500;
        }

        /* Fixed QR code styling */
        #qr-display {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 150px;
            /* Slightly larger for visibility */
            height: auto;
            background: white;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            /* Ensure it stays on top of everything */
        }
    </style>
</head>

<body>

    <div id="main-header">
        A model of a cuboidal bread box is given. Your school has decided to donate many such boxes to charity. <br>
        Find the volume of the bread box by counting the unit cubes of breads filled in it!
    </div>

    <div id="pointers-container">
        <div class="pointer-item">• What is the dimension (length × breadth) of the base layer?</div>
        <div class="pointer-item">• What does the number of unit cubes in each side of a layer represent? Compare it with the length and the breadth of a layer.</div>
        <div class="pointer-item">• What does the number of unit cubes in each layer represent? Will you obtain it by multiplying the length and the breadth of a layer? Compare it with the area of the layer.</div>
        <div class="pointer-item">• What does the number of layers represent? Compare it with the height of the cuboid.</div>
        <div class="pointer-item">• What does the total number of unit cubes in all the layers together represent? Compare it with the volume of the cuboid.</div>
        <div class="pointer-item">• What do you obtain when you divide the volume of the cuboid by the surface area of
            its base layer? Is it the number of layers? What can you call it otherwise?</div>
        <div class="pointer-item">• What do you obtain when you divide the volume of the cuboid by its height? Is it the number of unit cubes in one layer? What can you call it otherwise?</div>

        <div
            style="margin-top: 15px; color: #757575; font-style: italic; border-top: 1px solid #eee; padding-top: 10px; font-size: 14px;">
            Use hand gestures to rotate and span the cuboid while exploring these concepts
        </div>
    </div>

    <!-- THE QR CODE -->
    <img id="qr-display" src="breadboxqr.png" alt="Scan to explore">

    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        let scene, camera, renderer, controls;
        let breadGroup, exteriorEdges, acrylicMesh;
        let handles = [];
        const size = { x: 10, y: 1, z: 4 };

        const raycaster = new THREE.Raycaster();
        const pointer = new THREE.Vector2();
        let isDraggingHandle = false;
        let activeHandle = null;

        init();
        animate();

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xfcfcfc);

            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(16, 12, 18);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            const light = new THREE.DirectionalLight(0xfff5e6, 1.5);
            light.position.set(10, 20, 15);
            scene.add(light);
            scene.add(new THREE.AmbientLight(0xffffff, 0.8));

            breadGroup = new THREE.Group();
            scene.add(breadGroup);

            acrylicMesh = new THREE.Mesh(
                new THREE.BoxGeometry(1, 1, 1),
                new THREE.MeshPhongMaterial({ color: 0xeeeeee, transparent: true, opacity: 0.1, shininess: 100 })
            );
            scene.add(acrylicMesh);

            exteriorEdges = new THREE.Group();
            scene.add(exteriorEdges);

            createHandles();
            updateCuboid();

            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.mouseButtons = { LEFT: THREE.MOUSE.ROTATE, MIDDLE: THREE.MOUSE.DOLLY, RIGHT: THREE.MOUSE.ROTATE };
            controls.touches = { ONE: THREE.TOUCH.ROTATE, TWO: THREE.TOUCH.DOLLY_PAN };

            window.addEventListener('pointerdown', onPointerDown);
            window.addEventListener('pointermove', onPointerMove);
            window.addEventListener('pointerup', onPointerUp);
            window.addEventListener('resize', onWindowResize);
        }

        function createHandles() {
            const handleGeo = new THREE.SphereGeometry(0.5);
            const handleMat = new THREE.MeshBasicMaterial({ visible: false });
            const corners = [[1, 1, 1], [1, 1, -1], [1, -1, 1], [1, -1, -1], [-1, 1, 1], [-1, 1, -1], [-1, -1, 1], [-1, -1, -1]];
            corners.forEach(dir => {
                const handle = new THREE.Mesh(handleGeo, handleMat);
                handle.userData = { dir: new THREE.Vector3(...dir) };
                scene.add(handle);
                handles.push(handle);
            });
        }

        function updateCuboid() {
            while (breadGroup.children.length > 0) breadGroup.remove(breadGroup.children[0]);
            while (exteriorEdges.children.length > 0) exteriorEdges.remove(exteriorEdges.children[0]);

            const crustMat = new THREE.MeshPhongMaterial({ color: 0xcd853f });
            const crumbMat = new THREE.MeshPhongMaterial({ color: 0xf5f5dc });
            const materials = [crumbMat, crumbMat, crustMat, crustMat, crumbMat, crumbMat];

            const startX = -(size.x / 2) + 0.5;
            const startY = -(size.y / 2) + 0.5;
            const startZ = -(size.z / 2) + 0.5;

            for (let i = 0; i < size.x; i++) {
                for (let j = 0; j < size.y; j++) {
                    for (let k = 0; k < size.z; k++) {
                        const cube = new THREE.Mesh(new THREE.BoxGeometry(0.95, 0.95, 0.95), materials);
                        cube.position.set(startX + i, startY + j, startZ + k);
                        breadGroup.add(cube);
                    }
                }
            }

            acrylicMesh.scale.set(size.x, size.y, size.z);
            exteriorEdges.add(new THREE.LineSegments(
                new THREE.EdgesGeometry(new THREE.BoxGeometry(size.x, size.y, size.z)),
                new THREE.LineBasicMaterial({ color: 0x333333 })
            ));

            const hX = size.x / 2, hY = size.y / 2, hZ = size.z / 2;
            handles.forEach(h => h.position.set(hX * h.userData.dir.x, hY * h.userData.dir.y, hZ * h.userData.dir.z));
        }

        function onPointerDown(e) {
            // Check if clicking QR code to allow saving it
            if (e.target.id === 'qr-display') return;

            pointer.x = (e.clientX / window.innerWidth) * 2 - 1;
            pointer.y = -(e.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(pointer, camera);
            const hits = raycaster.intersectObjects(handles);
            if (hits.length > 0) { isDraggingHandle = true; activeHandle = hits[0].object; controls.enabled = false; }
            else { isDraggingHandle = false; controls.enabled = true; }
        }

        function onPointerMove(e) {
            if (!isDraggingHandle || !activeHandle) return;
            pointer.x = (e.clientX / window.innerWidth) * 2 - 1;
            pointer.y = -(e.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(pointer, camera);
            const plane = new THREE.Plane().setFromNormalAndCoplanarPoint(camera.getWorldDirection(new THREE.Vector3()), activeHandle.position);
            const pt = new THREE.Vector3();
            if (raycaster.ray.intersectPlane(plane, pt)) {
                const ny = Math.max(1, Math.min(4, Math.round(Math.abs(pt.y) * 2)));
                if (ny !== size.y) { size.y = ny; updateCuboid(); }
            }
        }

        function onPointerUp() { isDraggingHandle = false; activeHandle = null; controls.enabled = true; }
        function onWindowResize() { camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); }
        function animate() { requestAnimationFrame(animate); controls.update(); renderer.render(scene, camera); }
    </script>
</body>

</html>
